CREATE TABLE IF NOT EXISTS course_results (
  id SERIAL PRIMARY KEY,
  no INTEGER NOT NULL,
  type VARCHAR(64) NOT NULL,
  name VARCHAR(2048) NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE UNIQUE INDEX IF NOT EXISTS idx_course_results_no_type ON course_results (no, type);

CREATE TABLE IF NOT EXISTS courses(
  id SERIAL PRIMARY KEY,
  name VARCHAR(512) NOT NULL UNIQUE,
  teacher_id INTEGER,
  data JSONB,
  generated JSONB,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS course_topics(
  id SERIAL PRIMARY KEY,
  course_id INTEGER NOT NULL,
  index INTEGER NOT NULL,
  name VARCHAR(512) NOT NULL,
  lection TEXT NOT NULL,
  generated JSONB,
  data JSONB,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS teachers(
  id SERIAL PRIMARY KEY,
  name VARCHAR(512) NOT NULL UNIQUE,
  email VARCHAR(256) NOT NULL UNIQUE,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);