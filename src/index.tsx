import { serve } from "bun";
import index from "./index.html";
import { generate, generateAll, type DisciplineLessons, type QuizQuestion } from "./generator";
import { renderMethodDoc } from "./docx/method";

const server = serve({
  routes: {    
    "/*": index, // Serve index.html for all unmatched routes.

    "/api/method-generator": {
      async POST(req) {
        const discipline = await req.json() as DisciplineLessons;
        // const data = await generateAll(discipline);

        const doc = await renderMethodDoc({
          discipline: "–û–± º—î–∫—Ç–Ω–æ-–æ—Ä—ñ—î–Ω—Ç–æ–≤–∞–Ω–µ –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è",        
          topics: [
            {
              title: "–¢–µ—Å—Ç–æ–≤–∏–π —É—Ä–æ–∫",
              index: 1,
              keywords: "Inversion of Control, IoC, Dependency Injection, DI, C#, coupling.",
              selfQuestions: [
                "–ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è IoC —Ç–∞ DI –∑ —ñ–Ω—à–∏–º–∏ –ø–∞—Ç–µ—Ä–Ω–∞–º–∏ –ø—Ä–æ–µ–∫—Ç—É–≤–∞–Ω–Ω—è, —Ç–∞–∫–∏–º–∏ —è–∫ Factory —Ç–∞ Service Locator.",
                "–Ü—Å—Ç–æ—Ä—ñ—è —Ä–æ–∑–≤–∏—Ç–∫—É IoC —Ç–∞ DI: —è–∫ —Ü—ñ –∫–æ–Ω—Ü–µ–ø—Ü—ñ—ó –µ–≤–æ–ª—é—Ü—ñ–æ–Ω—É–≤–∞–ª–∏ –≤ –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—ñ.",
                "–í–ø–ª–∏–≤ IoC —Ç–∞ DI –Ω–∞ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä—É –º—ñ–∫—Ä–æ—Å–µ—Ä–≤—ñ—Å—ñ–≤.",
                "–†–æ–ª—å IoC —Ç–∞ DI —É –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—ñ –ø—Ä–∏–Ω—Ü–∏–ø—ñ–≤ SOLID, –æ–∫—Ä—ñ–º Dependency Inversion Principle.",
                "–ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è —Ä—ñ–∑–Ω–∏—Ö IoC –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ–≤: –ø–µ—Ä–µ–≤–∞–≥–∏ —Ç–∞ –Ω–µ–¥–æ–ª—ñ–∫–∏ –∫–æ–∂–Ω–æ–≥–æ.",
                "–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è IoC —Ç–∞ DI —É —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—ñ: –ø—ñ–¥—Ö–æ–¥–∏ —Ç–∞ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏."
              ],
              referats: [
                "–í—Å—Ç—É–ø –¥–æ —ñ–Ω–≤–µ—Ä—Å—ñ—ó –∫–µ—Ä—É–≤–∞–Ω–Ω—è (IoC) —Ç–∞ —ñ–Ω‚Äô—î–∫—Ü—ñ—ó –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π (DI) –≤ C#",
                "–ü—Ä–æ–±–ª–µ–º–∞ —Å–∏–ª—å–Ω–æ—ó –∑–≤‚Äô—è–∑–∞–Ω–æ—Å—Ç—ñ –≤ –æ–±‚Äô—î–∫—Ç–Ω–æ-–æ—Ä—ñ—î–Ω—Ç–æ–≤–∞–Ω–æ–º—É –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—ñ",
                "–ü—Ä–∏–Ω—Ü–∏–ø —ñ–Ω–≤–µ—Ä—Å—ñ—ó –∫–µ—Ä—É–≤–∞–Ω–Ω—è (IoC) —Ç–∞ –π–æ–≥–æ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—è –≤ C#",
                "–¢–∏–ø–∏ —ñ–Ω‚Äô—î–∫—Ü—ñ—ó –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π: –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä, –≤–ª–∞—Å—Ç–∏–≤—ñ—Å—Ç—å, –º–µ—Ç–æ–¥",
                "–ü–µ—Ä–µ–≤–∞–≥–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —ñ–Ω‚Äô—î–∫—Ü—ñ—ó –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π —É C#"
              ],
              quiz: [
                {
                  "index": 1,
                  "question": "–©–æ —Ç–∞–∫–µ —ñ–Ω–≤–µ—Ä—Å—ñ—è –∫–µ—Ä—É–≤–∞–Ω–Ω—è (IoC) –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ñ –û–û–ü?",                
                  "option1": "–ü—Ä–æ—Ü–µ—Å, –∫–æ–ª–∏ –æ–±'—î–∫—Ç —Å–∞–º —Å—Ç–≤–æ—Ä—é—î —Å–≤–æ—ó –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ",
                  "option2": "–ü—Ä–æ—Ü–µ—Å, –∫–æ–ª–∏ –æ–±'—î–∫—Ç –æ—Ç—Ä–∏–º—É—î –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –∑–∑–æ–≤–Ω—ñ",
                  "option3": "–ü—Ä–æ—Ü–µ—Å, –∫–æ–ª–∏ –æ–±'—î–∫—Ç –Ω–µ –º–∞—î –∂–æ–¥–Ω–∏—Ö –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π",
                  "option4": "–ü—Ä–æ—Ü–µ—Å, –∫–æ–ª–∏ –æ–±'—î–∫—Ç —Å—Ç–≤–æ—Ä—é—î –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –¥–ª—è —ñ–Ω—à–∏—Ö –æ–±'—î–∫—Ç—ñ–≤"
              
                },
                {
                  "index": 2,
                  "question": "–Ø–∫–∞ –∑ –Ω–∞–≤–µ–¥–µ–Ω–∏—Ö —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ–π —î –ø—Ä–∏–∫–ª–∞–¥–æ–º —ñ–Ω‚Äô—î–∫—Ü—ñ—ó –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π —á–µ—Ä–µ–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä?",
                  "option1": "public void Notify(string message, IMessageService service)",
                  "option2": "public IMessageService MessageService { get; set; }",
                  "option3": "public NotificationManager(IMessageService messageService)",
                  "option4": "public void SendEmail(string message)"
                }
              ] as QuizQuestion[],
              keyQuestions: [
                "–©–æ —Ç–∞–∫–µ —ñ–Ω–≤–µ—Ä—Å—ñ—è –∫–µ—Ä—É–≤–∞–Ω–Ω—è (IoC) —É –∫–æ–Ω—Ç–µ–∫—Å—Ç—ñ —Ä–æ–∑—Ä–æ–±–∫–∏ –ø—Ä–æ–≥—Ä–∞–º–Ω–æ–≥–æ –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è?",
                "–Ø–∫—ñ –ø—Ä–æ–±–ª–µ–º–∏ –≤–∏–Ω–∏–∫–∞—é—Ç—å —á–µ—Ä–µ–∑ —Å–∏–ª—å–Ω—É –∑–≤‚Äô—è–∑–∞–Ω—ñ—Å—Ç—å –º—ñ–∂ –∫–ª–∞—Å–∞–º–∏?",
                "–Ø–∫ –ø—Ä–∏–Ω—Ü–∏–ø —ñ–Ω–≤–µ—Ä—Å—ñ—ó –∫–µ—Ä—É–≤–∞–Ω–Ω—è –¥–æ–ø–æ–º–∞–≥–∞—î –∑–º–µ–Ω—à–∏—Ç–∏ –∑–≤‚Äô—è–∑–∞–Ω—ñ—Å—Ç—å –º—ñ–∂ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏?",
                "–©–æ —Ç–∞–∫–µ —ñ–Ω‚Äô—î–∫—Ü—ñ—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π (Dependency Injection, DI)?",
                "–Ø–∫—ñ –æ—Å–Ω–æ–≤–Ω—ñ —Ç–∏–ø–∏ —ñ–Ω‚Äô—î–∫—Ü—ñ—ó –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π —ñ—Å–Ω—É—é—Ç—å?"
              ]
            },
            {
              title: "–î—Ä—É–≥–∏–π —Ç–µ—Å—Ç–æ–≤–∏–π —É—Ä–æ–∫",
              index: 2,
              keywords: "Dependency Injection, DI, C#, coupling.",
              selfQuestions: [
                "–†–æ–ª—å IoC —Ç–∞ DI —É –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—ñ –ø—Ä–∏–Ω—Ü–∏–ø—ñ–≤ SOLID, –æ–∫—Ä—ñ–º Dependency Inversion Principle.",
                "–ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è —Ä—ñ–∑–Ω–∏—Ö IoC –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ–≤: –ø–µ—Ä–µ–≤–∞–≥–∏ —Ç–∞ –Ω–µ–¥–æ–ª—ñ–∫–∏ –∫–æ–∂–Ω–æ–≥–æ.",
                "–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è IoC —Ç–∞ DI —É —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—ñ: –ø—ñ–¥—Ö–æ–¥–∏ —Ç–∞ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏.",
                "–ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è IoC —Ç–∞ DI –∑ —ñ–Ω—à–∏–º–∏ –ø–∞—Ç–µ—Ä–Ω–∞–º–∏ –ø—Ä–æ–µ–∫—Ç—É–≤–∞–Ω–Ω—è, —Ç–∞–∫–∏–º–∏ —è–∫ Factory —Ç–∞ Service Locator.",
                "–Ü—Å—Ç–æ—Ä—ñ—è —Ä–æ–∑–≤–∏—Ç–∫—É IoC —Ç–∞ DI: —è–∫ —Ü—ñ –∫–æ–Ω—Ü–µ–ø—Ü—ñ—ó –µ–≤–æ–ª—é—Ü—ñ–æ–Ω—É–≤–∞–ª–∏ –≤ –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—ñ.",
                "–í–ø–ª–∏–≤ IoC —Ç–∞ DI –Ω–∞ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä—É –º—ñ–∫—Ä–æ—Å–µ—Ä–≤—ñ—Å—ñ–≤."                
              ],
              referats: [
                "–í—Å—Ç—É–ø –¥–æ —ñ–Ω–≤–µ—Ä—Å—ñ—ó –∫–µ—Ä—É–≤–∞–Ω–Ω—è (IoC) —Ç–∞ —ñ–Ω‚Äô—î–∫—Ü—ñ—ó –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π (DI) –≤ C#",
                "–ü—Ä–æ–±–ª–µ–º–∞ —Å–∏–ª—å–Ω–æ—ó –∑–≤‚Äô—è–∑–∞–Ω–æ—Å—Ç—ñ –≤ –æ–±‚Äô—î–∫—Ç–Ω–æ-–æ—Ä—ñ—î–Ω—Ç–æ–≤–∞–Ω–æ–º—É –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—ñ",
                "–ü—Ä–∏–Ω—Ü–∏–ø —ñ–Ω–≤–µ—Ä—Å—ñ—ó –∫–µ—Ä—É–≤–∞–Ω–Ω—è (IoC) —Ç–∞ –π–æ–≥–æ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—è –≤ C#",
                "–¢–∏–ø–∏ —ñ–Ω‚Äô—î–∫—Ü—ñ—ó –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π: –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä, –≤–ª–∞—Å—Ç–∏–≤—ñ—Å—Ç—å, –º–µ—Ç–æ–¥",
                "–ü–µ—Ä–µ–≤–∞–≥–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —ñ–Ω‚Äô—î–∫—Ü—ñ—ó –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π —É C#"
              ],
              quiz: [
                {
                  "index": 1,
                  "question": "–©–æ —Ç–∞–∫–µ —ñ–Ω–≤–µ—Ä—Å—ñ—è –∫–µ—Ä—É–≤–∞–Ω–Ω—è (IoC) –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ñ –û–û–ü?",                
                  "option1": "–ü—Ä–æ—Ü–µ—Å, –∫–æ–ª–∏ –æ–±'—î–∫—Ç —Å–∞–º —Å—Ç–≤–æ—Ä—é—î —Å–≤–æ—ó –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ",
                  "option2": "–ü—Ä–æ—Ü–µ—Å, –∫–æ–ª–∏ –æ–±'—î–∫—Ç –æ—Ç—Ä–∏–º—É—î –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –∑–∑–æ–≤–Ω—ñ",
                  "option3": "–ü—Ä–æ—Ü–µ—Å, –∫–æ–ª–∏ –æ–±'—î–∫—Ç –Ω–µ –º–∞—î –∂–æ–¥–Ω–∏—Ö –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π",
                  "option4": "–ü—Ä–æ—Ü–µ—Å, –∫–æ–ª–∏ –æ–±'—î–∫—Ç —Å—Ç–≤–æ—Ä—é—î –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –¥–ª—è —ñ–Ω—à–∏—Ö –æ–±'—î–∫—Ç—ñ–≤"
              
                },
                {
                  "index": 2,
                  "question": "–Ø–∫–∞ –∑ –Ω–∞–≤–µ–¥–µ–Ω–∏—Ö —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ–π —î –ø—Ä–∏–∫–ª–∞–¥–æ–º —ñ–Ω‚Äô—î–∫—Ü—ñ—ó –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π —á–µ—Ä–µ–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä?",
                  "option1": "public void Notify(string message, IMessageService service)",
                  "option2": "public IMessageService MessageService { get; set; }",
                  "option3": "public NotificationManager(IMessageService messageService)",
                  "option4": "public void SendEmail(string message)"
                }
              ] as QuizQuestion[],
              keyQuestions: [
                "–©–æ —Ç–∞–∫–µ —ñ–Ω–≤–µ—Ä—Å—ñ—è –∫–µ—Ä—É–≤–∞–Ω–Ω—è (IoC) —É –∫–æ–Ω—Ç–µ–∫—Å—Ç—ñ —Ä–æ–∑—Ä–æ–±–∫–∏ –ø—Ä–æ–≥—Ä–∞–º–Ω–æ–≥–æ –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è?",
                "–Ø–∫—ñ –ø—Ä–æ–±–ª–µ–º–∏ –≤–∏–Ω–∏–∫–∞—é—Ç—å —á–µ—Ä–µ–∑ —Å–∏–ª—å–Ω—É –∑–≤‚Äô—è–∑–∞–Ω—ñ—Å—Ç—å –º—ñ–∂ –∫–ª–∞—Å–∞–º–∏?",
                "–Ø–∫ –ø—Ä–∏–Ω—Ü–∏–ø —ñ–Ω–≤–µ—Ä—Å—ñ—ó –∫–µ—Ä—É–≤–∞–Ω–Ω—è –¥–æ–ø–æ–º–∞–≥–∞—î –∑–º–µ–Ω—à–∏—Ç–∏ –∑–≤‚Äô—è–∑–∞–Ω—ñ—Å—Ç—å –º—ñ–∂ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏?",
                "–©–æ —Ç–∞–∫–µ —ñ–Ω‚Äô—î–∫—Ü—ñ—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π (Dependency Injection, DI)?",
                "–Ø–∫—ñ –æ—Å–Ω–æ–≤–Ω—ñ —Ç–∏–ø–∏ —ñ–Ω‚Äô—î–∫—Ü—ñ—ó –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π —ñ—Å–Ω—É—é—Ç—å?"
              ]
            }
          ]
        })

        return new Response(doc, { 
          headers: {
            "Content-Type": "application/vnd.openxmlformats-officedocument.wordprocessingml.document",
            "Content-Disposition": "inline; filename=\"method.docx\"",
          }
        });
      }      
    }
  },

  development: process.env.NODE_ENV !== "production" && {
    hmr: true, // Enable browser hot reloading in development
    console: true, // Echo console logs from the browser to the server
  }
});

console.log(`üöÄ Server running at ${server.url}`);
